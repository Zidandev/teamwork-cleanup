<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teamwork Cleanup - Catch The Bottles</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Orbitron', monospace;
            overflow: hidden;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #064e3b 0%, #065f46 25%, #047857 50%, #059669 75%, #10b981 100%);
        }
        .glow {
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
        }
        .particle {
            position: fixed;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, #10b981 0%, #059669 50%, #047857 100%);
            border-radius: 50%;
            pointer-events: none;
            box-shadow: 0 0 10px #10b981;
            z-index: 1000;
        }
        
        .basket-shadow {
            position: absolute;
            background: linear-gradient(90deg, transparent 0%, rgba(16, 185, 129, 0.3) 50%, transparent 100%);
            border-radius: 50%;
            pointer-events: none;
        }
        #gameCanvas {
            border: 2px solid #10b981;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.3);
            cursor: none; /* Hide cursor when using swipe control */
        }
        #gameCanvas.arrow-control {
            cursor: default;
        }
        .btn-futuristic {
            background: linear-gradient(45deg, #047857, #059669);
            border: 2px solid #10b981;
            transition: all 0.3s ease;
        }
        .btn-futuristic:hover {
            background: linear-gradient(45deg, #059669, #10b981);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.6);
            transform: translateY(-2px);
        }
        .control-option {
            background: linear-gradient(45deg, #064e3b, #065f46);
            border: 1px solid #047857;
            transition: all 0.3s ease;
        }
        .control-option.selected {
            background: linear-gradient(45deg, #047857, #059669);
            border: 2px solid #10b981;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.5);
        }
        .loading-message {
            background: rgba(6, 95, 70, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid #10b981;
        }
    </style>
</head>
<body class="gradient-bg text-green-100 min-h-screen flex items-center justify-center">
    
    <!-- Loading Screen -->
    <div id="loadingScreen" class="text-center max-w-md mx-auto p-6">
        <h1 class="text-4xl md:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-300 mb-4 glow">
            LOADING...
        </h1>
        <div class="loading-message p-4 rounded-lg mb-4">
            <p class="text-sm text-green-300 mb-2">Memuat gambar permainan...</p>
            <div class="w-full bg-green-900 rounded-full h-2">
                <div id="loadingBar" class="bg-green-500 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>
            <p id="loadingText" class="text-xs text-green-400 mt-2">0/3 gambar dimuat</p>
        </div>
        <div class="text-xs text-green-400">
            <p>Pastikan file botol.png, kulit.png, dan baterai.png tersedia</p>
        </div>
    </div>

    <!-- Menu Screen -->
    <div id="menuScreen" class="hidden text-center max-w-md mx-auto p-6">
        <h1 class="text-4xl md:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-300 mb-2 glow">
            TEAMWORK CLEANUP
        </h1>
        <p class="text-lg md:text-xl text-green-300 mb-8">Catch The Bottles</p>
        
        <div class="bg-green-900/30 backdrop-blur-sm p-6 rounded-lg border border-green-500/30 mb-6">
            <h2 class="text-xl font-bold mb-4 text-green-300">CARA BERMAIN</h2>
            <div class="text-sm text-left space-y-2">
                <p>‚Ä¢ Tangkap hanya sampah BOTOL yang jatuh</p>
                <p>‚Ä¢ Hindari sampah jenis lain (GAME OVER)</p>
                <p>‚Ä¢ Kumpulkan 100 botol untuk menang</p>
                <p>‚Ä¢ Gunakan kontrol yang dipilih</p>
                <p>‚Ä¢ Kesulitan meningkat seiring waktu!</p>
            </div>
        </div>

        <div class="mb-6">
            <h3 class="text-lg font-bold mb-4 text-green-300">PILIH KONTROL</h3>
            <div class="grid grid-cols-2 gap-4">
                <button id="arrowControl" class="control-option selected p-4 rounded-lg text-sm">
                    <div class="font-bold">ARROW KEYS</div>
                    <div class="text-xs text-green-300">‚Üê ‚Üí Keys</div>
                </button>
                <button id="swipeControl" class="control-option p-4 rounded-lg text-sm">
                    <div class="font-bold">TOUCH/MOUSE</div>
                    <div class="text-xs text-green-300">Follow Pointer</div>
                </button>
            </div>
        </div>

        <button id="startBtn" class="btn-futuristic text-white font-bold py-4 px-8 rounded-lg text-lg glow">
            MULAI BERMAIN
        </button>
        
        <button id="fullscreenBtn" class="btn-futuristic text-white font-bold py-2 px-6 rounded-lg text-sm mt-4 block mx-auto">
            FULLSCREEN
        </button>

        <div class="mt-8 text-xs text-green-400">
            <p>Created by <span class="font-bold text-green-300">Zidandev</span></p>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="gameScreen" class="hidden flex flex-col items-center justify-center p-4">
        <div class="flex justify-between items-center w-full max-w-4xl mb-4">
            <div class="text-xl font-bold">
                SKOR: <span id="score" class="text-green-300">0</span>/100
                <div class="text-sm text-green-400">Level: <span id="level" class="text-green-300">1</span></div>
            </div>
            <button id="pauseBtn" class="btn-futuristic text-white font-bold py-2 px-4 rounded text-sm">
                PAUSE
            </button>
        </div>
        <canvas id="gameCanvas" width="800" height="600" class="max-w-full h-auto"></canvas>
        
        <div id="mobileControls" class="mt-4 hidden">
            <button id="leftBtn" class="btn-futuristic text-white font-bold py-4 px-8 rounded-lg mr-4">
                ‚Üê
            </button>
            <button id="rightBtn" class="btn-futuristic text-white font-bold py-4 px-8 rounded-lg">
                ‚Üí
            </button>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div id="gameOverScreen" class="hidden fixed inset-0 flex items-center justify-center z-50">
        <div class="bg-green-900/90 backdrop-blur-md p-8 rounded-2xl border-2 border-green-500 text-center max-w-md mx-4 glow">
            <div id="gameOverIcon" class="text-6xl mb-4">üéâ</div>
            <h2 id="gameOverTitle" class="text-3xl font-black text-transparent bg-clip-text bg-gradient-to-r from-green-400 to-emerald-300 mb-4">
                SELAMAT!
            </h2>
            <p id="gameOverMessage" class="text-lg text-green-300 mb-6">
                Kamu berhasil mengumpulkan 100 botol!
            </p>
            <div id="finalScore" class="text-2xl font-bold text-green-400 mb-6">
                Skor: <span>100</span>/100
            </div>
            <div class="space-y-3">
                <button id="restartBtn" class="btn-futuristic text-white font-bold py-3 px-6 rounded-lg w-full glow">
                    üîÑ MAIN LAGI
                </button>
                <button id="exitBtn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-lg w-full border-2 border-red-500 transition-all">
                    üö™ KELUAR
                </button>
            </div>
        </div>
    </div>

    <!-- Audio Elements -->
    <audio id="bgm" loop>
        <source src="bgm.mp3" type="audio/mp3">
    </audio>
    <audio id="catchSfx">
        <source src="catch.mp3" type="audio/mp3">
    </audio>
    <audio id="winSfx">
        <source src="win.mp3" type="audio/mp3">
    </audio>
    <audio id="loseSfx">
        <source src="lose.mp3" type="audio/mp3">
    </audio>

    <script>
        // Game Variables
        let canvas, ctx;
        let gameState = 'loading'; // loading, menu, playing, paused, won, lost
        let score = 0;
        let controlType = 'arrow'; // arrow or swipe
        let basketX = 400;
        let basketY = 550;
        let basketWidth = 80;
        let basketHeight = 40;
        let basketTargetX = 400;
        let basketShake = { x: 0, y: 0, intensity: 0 };
        let basketShadow = null;
        let items = [];
        let keys = {};
        let gameSpeed = 2;
        let currentLevel = 1;
        let spawnTimer = 0;
        
        // Touch/Mouse control variables
        let isPointerActive = false;
        let pointerX = 0;
        
        // Image loading
        let images = {};
        let imagesLoaded = 0;
        let totalImages = 3;
        
        // Item types with image paths
        const itemTypes = {
            botol: { imagePath: 'botol.png', correct: true },
            salah1: { imagePath: 'kulit.png', correct: false },
            salah2: { imagePath: 'baterai.png', correct: false }
        };

        // Initialize game
        function init() {
            loadImages();
        }

        function loadImages() {
            const imageNames = ['botol', 'salah1', 'salah2'];
            
            imageNames.forEach((name, index) => {
                const img = new Image();
                img.onload = () => {
                    images[name] = img;
                    imagesLoaded++;
                    updateLoadingProgress();
                    
                    if (imagesLoaded === totalImages) {
                        setTimeout(() => {
                            showMenuScreen();
                        }, 500);
                    }
                };
                
                img.onerror = () => {
                    console.error(`Failed to load image: ${itemTypes[name].imagePath}`);
                    // Create fallback colored rectangle
                    const fallbackCanvas = document.createElement('canvas');
                    fallbackCanvas.width = 30;
                    fallbackCanvas.height = 30;
                    const fallbackCtx = fallbackCanvas.getContext('2d');
                    
                    // Use different colors for fallback
                    const fallbackColors = {
                        botol: '#3B82F6',
                        salah1: '#EF4444',
                        salah2: '#F59E0B'
                    };
                    
                    fallbackCtx.fillStyle = fallbackColors[name];
                    fallbackCtx.fillRect(0, 0, 30, 30);
                    
                    // Add text indicator
                    fallbackCtx.fillStyle = '#ffffff';
                    fallbackCtx.font = '8px Arial';
                    fallbackCtx.textAlign = 'center';
                    fallbackCtx.fillText(name.toUpperCase(), 15, 18);
                    
                    images[name] = fallbackCanvas;
                    imagesLoaded++;
                    updateLoadingProgress();
                    
                    if (imagesLoaded === totalImages) {
                        setTimeout(() => {
                            showMenuScreen();
                        }, 500);
                    }
                };
                
                img.src = itemTypes[name].imagePath;
            });
        }

        function updateLoadingProgress() {
            const progress = (imagesLoaded / totalImages) * 100;
            document.getElementById('loadingBar').style.width = progress + '%';
            document.getElementById('loadingText').textContent = `${imagesLoaded}/${totalImages} gambar dimuat`;
        }

        function showMenuScreen() {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('menuScreen').classList.remove('hidden');
            gameState = 'menu';
            setupEventListeners();
            checkMobileDevice();
        }

        function setupEventListeners() {
            // Menu controls
            document.getElementById('startBtn').addEventListener('click', startGame);
            document.getElementById('fullscreenBtn').addEventListener('click', toggleFullscreen);
            document.getElementById('arrowControl').addEventListener('click', () => selectControl('arrow'));
            document.getElementById('swipeControl').addEventListener('click', () => selectControl('swipe'));
            
            // Game over controls
            document.getElementById('restartBtn').addEventListener('click', restartGame);
            document.getElementById('exitBtn').addEventListener('click', exitGame);
            document.getElementById('pauseBtn').addEventListener('click', togglePause);
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);
            
            // Mobile controls
            document.getElementById('leftBtn').addEventListener('touchstart', (e) => {
                e.preventDefault();
                keys['ArrowLeft'] = true;
            });
            document.getElementById('leftBtn').addEventListener('touchend', (e) => {
                e.preventDefault();
                keys['ArrowLeft'] = false;
            });
            document.getElementById('rightBtn').addEventListener('touchstart', (e) => {
                e.preventDefault();
                keys['ArrowRight'] = true;
            });
            document.getElementById('rightBtn').addEventListener('touchend', (e) => {
                e.preventDefault();
                keys['ArrowRight'] = false;
            });
        }

        function checkMobileDevice() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            if (isMobile && controlType === 'arrow') {
                document.getElementById('mobileControls').classList.remove('hidden');
            }
        }

        function selectControl(type) {
            controlType = type;
            document.querySelectorAll('.control-option').forEach(btn => btn.classList.remove('selected'));
            if (type === 'arrow') {
                document.getElementById('arrowControl').classList.add('selected');
            } else {
                document.getElementById('swipeControl').classList.add('selected');
            }
        }

        function startGame() {
            document.getElementById('menuScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // Set canvas cursor based on control type
            if (controlType === 'swipe') {
                canvas.classList.remove('arrow-control');
                setupPointerControls();
            } else {
                canvas.classList.add('arrow-control');
                removePointerControls();
                checkMobileDevice();
            }
            
            // Create basket shadow element
            createBasketShadow();
            
            // Start BGM
            document.getElementById('bgm').play().catch(e => console.log('Audio play failed'));
            
            gameState = 'playing';
            resetGame();
            gameLoop();
        }

        function setupPointerControls() {
            // Remove mobile controls for swipe mode
            document.getElementById('mobileControls').classList.add('hidden');
            
            // Touch events
            canvas.addEventListener('touchstart', handlePointerStart, { passive: false });
            canvas.addEventListener('touchmove', handlePointerMove, { passive: false });
            canvas.addEventListener('touchend', handlePointerEnd, { passive: false });
            canvas.addEventListener('touchcancel', handlePointerEnd, { passive: false });
            
            // Mouse events
            canvas.addEventListener('mouseenter', handlePointerStart);
            canvas.addEventListener('mousemove', handlePointerMove);
            canvas.addEventListener('mouseleave', handlePointerEnd);
            canvas.addEventListener('mousedown', handlePointerStart);
            canvas.addEventListener('mouseup', handlePointerEnd);
        }

        function removePointerControls() {
            // Remove all pointer event listeners
            canvas.removeEventListener('touchstart', handlePointerStart);
            canvas.removeEventListener('touchmove', handlePointerMove);
            canvas.removeEventListener('touchend', handlePointerEnd);
            canvas.removeEventListener('touchcancel', handlePointerEnd);
            canvas.removeEventListener('mouseenter', handlePointerStart);
            canvas.removeEventListener('mousemove', handlePointerMove);
            canvas.removeEventListener('mouseleave', handlePointerEnd);
            canvas.removeEventListener('mousedown', handlePointerStart);
            canvas.removeEventListener('mouseup', handlePointerEnd);
        }

        function handlePointerStart(e) {
            e.preventDefault();
            isPointerActive = true;
            updatePointerPosition(e);
        }

        function handlePointerMove(e) {
            e.preventDefault();
            if (gameState !== 'playing') return;
            updatePointerPosition(e);
        }

        function handlePointerEnd(e) {
            e.preventDefault();
            isPointerActive = false;
        }

        function updatePointerPosition(e) {
            if (gameState !== 'playing') return;
            
            const rect = canvas.getBoundingClientRect();
            let clientX;
            
            if (e.type.startsWith('touch')) {
                if (e.touches && e.touches.length > 0) {
                    clientX = e.touches[0].clientX;
                } else if (e.changedTouches && e.changedTouches.length > 0) {
                    clientX = e.changedTouches[0].clientX;
                } else {
                    return;
                }
            } else {
                clientX = e.clientX;
            }
            
            // Convert screen coordinates to canvas coordinates
            const canvasScale = canvas.width / rect.width;
            pointerX = (clientX - rect.left) * canvasScale;
            
            // Update basket target position directly
            basketTargetX = Math.max(0, Math.min(canvas.width - basketWidth, pointerX - basketWidth / 2));
        }

        function resetGame() {
            score = 0;
            basketX = canvas.width / 2 - basketWidth / 2;
            basketTargetX = basketX;
            basketShake = { x: 0, y: 0, intensity: 0 };
            items = [];
            gameSpeed = 2;
            spawnTimer = 0;
            currentLevel = 1;
            isPointerActive = false;
            document.getElementById('score').textContent = score;
            document.getElementById('level').textContent = currentLevel;
        }

        function createBasketShadow() {
            if (basketShadow) basketShadow.remove();
            
            basketShadow = document.createElement('div');
            basketShadow.className = 'basket-shadow';
            basketShadow.style.width = (basketWidth * 1.5) + 'px';
            basketShadow.style.height = '20px';
            basketShadow.style.left = '0px';
            basketShadow.style.top = '0px';
            canvas.parentElement.appendChild(basketShadow);
            updateBasketShadow();
        }

        function updateBasketShadow() {
            if (!basketShadow) return;
            
            const rect = canvas.getBoundingClientRect();
            const canvasScale = rect.width / canvas.width;
            
            basketShadow.style.left = (rect.left + (basketX - basketWidth * 0.25) * canvasScale) + 'px';
            basketShadow.style.top = (rect.top + (basketY + basketHeight + 5) * canvasScale) + 'px';
            basketShadow.style.width = (basketWidth * 1.5 * canvasScale) + 'px';
            basketShadow.style.height = (20 * canvasScale) + 'px';
        }

        function shakeBasket(intensity = 15) {
            basketShake.intensity = intensity;
            
            // Create shake animation
            const shakeAnimation = () => {
                if (basketShake.intensity > 0) {
                    basketShake.x = (Math.random() - 0.5) * basketShake.intensity;
                    basketShake.y = (Math.random() - 0.5) * basketShake.intensity;
                    basketShake.intensity *= 0.9; // Decay the shake
                    
                    if (basketShake.intensity > 0.5) {
                        requestAnimationFrame(shakeAnimation);
                    } else {
                        basketShake = { x: 0, y: 0, intensity: 0 };
                    }
                }
            };
            
            shakeAnimation();
        }

        function togglePause() {
            if (gameState === 'playing') {
                gameState = 'paused';
                document.getElementById('pauseBtn').textContent = 'RESUME';
            } else if (gameState === 'paused') {
                gameState = 'playing';
                document.getElementById('pauseBtn').textContent = 'PAUSE';
            }
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // Input handlers
        function handleKeyDown(e) {
            keys[e.code] = true;
        }

        function handleKeyUp(e) {
            keys[e.code] = false;
        }

        // Dynamic spawn rate based on score
        function getSpawnRate() {
            // Base spawn rate starts at 0.015
            // As score approaches 100, spawn rate increases to 0.08
            const progress = score / 100;
            const baseRate = 0.015;
            const maxRate = 0.08;
            return baseRate + (maxRate - baseRate) * Math.pow(progress, 1.5);
        }

        function updateLevel() {
            const newLevel = Math.floor(score / 20) + 1;
            if (newLevel !== currentLevel) {
                currentLevel = newLevel;
                document.getElementById('level').textContent = currentLevel;
                
                // Visual feedback for level up
                createLevelUpEffect();
            }
        }

        function createLevelUpEffect() {
            // Screen flash for level up
            const flash = document.createElement('div');
            flash.style.position = 'fixed';
            flash.style.top = '0';
            flash.style.left = '0';
            flash.style.width = '100vw';
            flash.style.height = '100vh';
            flash.style.background = 'radial-gradient(circle, rgba(16, 185, 129, 0.4) 0%, transparent 70%)';
            flash.style.pointerEvents = 'none';
            flash.style.zIndex = '999';
            document.body.appendChild(flash);
            
            anime({
                targets: flash,
                opacity: [0, 0.8, 0],
                duration: 800,
                easing: 'easeOutQuad',
                complete: () => flash.remove()
            });
        }

        // Game logic
        function update() {
            if (gameState !== 'playing') return;

            // Update level
            updateLevel();

            // Smooth basket movement
            const diff = basketTargetX - basketX;
            const smoothing = controlType === 'swipe' ? 0.25 : 0.15; // More responsive for touch control
            basketX += diff * smoothing;
            
            // Update basket position (arrow keys only)
            if (controlType === 'arrow') {
                if (keys['ArrowLeft'] && basketTargetX > 0) {
                    basketTargetX -= 8;
                }
                if (keys['ArrowRight'] && basketTargetX < canvas.width - basketWidth) {
                    basketTargetX += 8;
                }
            }
            
            // Update shadow position
            updateBasketShadow();

            // Dynamic spawn system
            spawnTimer++;
            const currentSpawnRate = getSpawnRate();
            
            if (Math.random() < currentSpawnRate) {
                const itemTypeKeys = Object.keys(itemTypes);
                const randomType = itemTypeKeys[Math.floor(Math.random() * itemTypeKeys.length)];
                
                items.push({
                    x: Math.random() * (canvas.width - 30),
                    y: -30,
                    type: randomType,
                    width: 30,
                    height: 30,
                    speed: gameSpeed + Math.random() * 2 // Variable speed
                });
            }

            // Update items
            for (let i = items.length - 1; i >= 0; i--) {
                const item = items[i];
                item.y += item.speed;

                // Check collision with basket
                if (item.y + item.height >= basketY &&
                    item.x + item.width >= basketX &&
                    item.x <= basketX + basketWidth &&
                    item.y <= basketY + basketHeight) {
                    
                    if (itemTypes[item.type].correct) {
                        // Correct item (bottle) - shake basket
                        score++;
                        document.getElementById('score').textContent = score;
                        document.getElementById('catchSfx').play().catch(e => {});
                        
                        // Shake basket animation
                        shakeBasket(12);
                        
                        createParticles(item.x + item.width / 2, item.y + item.height / 2);
                        
                        if (score >= 100) {
                            winGame();
                            return;
                        }
                        
                        // Increase speed every 20 points
                        if (score % 20 === 0) {
                            gameSpeed += 0.3;
                        }
                    } else {
                        // Wrong item - game over
                        loseGame();
                        return;
                    }
                    
                    items.splice(i, 1);
                } else if (item.y > canvas.height) {
                    // Item fell off screen
                    items.splice(i, 1);
                }
            }
        }

        function render() {
            // Clear canvas with gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#064e3b');
            gradient.addColorStop(1, '#065f46');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Apply shake offset to basket position
            const shakeOffsetX = basketShake.x;
            const shakeOffsetY = basketShake.y;

            // Draw basket glow effect
            ctx.shadowColor = '#10b981';
            ctx.shadowBlur = 15;
            ctx.fillStyle = '#10b981';
            ctx.fillRect(basketX + shakeOffsetX, basketY + shakeOffsetY, basketWidth, basketHeight);
            
            // Reset shadow
            ctx.shadowBlur = 0;
            
            // Draw basket border
            ctx.strokeStyle = '#047857';
            ctx.lineWidth = 3;
            ctx.strokeRect(basketX + shakeOffsetX, basketY + shakeOffsetY, basketWidth, basketHeight);
            
            // Draw basket highlight
            ctx.fillStyle = '#34d399';
            ctx.fillRect(basketX + shakeOffsetX + 2, basketY + shakeOffsetY + 2, basketWidth - 4, 8);

            // Draw pointer indicator for swipe control
            if (controlType === 'swipe' && gameState === 'playing') {
                ctx.fillStyle = 'rgba(16, 185, 129, 0.3)';
                ctx.fillRect(pointerX - 2, 0, 4, canvas.height);
                
                // Draw pointer dot
                ctx.fillStyle = '#10b981';
                ctx.beginPath();
                ctx.arc(pointerX, 30, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 10;
                ctx.shadowColor = '#10b981';
                ctx.beginPath();
                ctx.arc(pointerX, 30, 8, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
            }

            // Draw items with images (no outlines)
            items.forEach(item => {
                if (images[item.type]) {
                    // Draw image with glow effect
                    ctx.shadowColor = itemTypes[item.type].correct ? '#10b981' : '#ef4444';
                    ctx.shadowBlur = 8;
                    ctx.drawImage(images[item.type], item.x, item.y, item.width, item.height);
                    ctx.shadowBlur = 0;
                } else {
                    // Fallback to colored rectangle if image not loaded (no outline)
                    const fallbackColors = {
                        botol: '#3B82F6',
                        salah1: '#EF4444',
                        salah2: '#F59E0B'
                    };
                    ctx.fillStyle = fallbackColors[item.type];
                    ctx.fillRect(item.x, item.y, item.width, item.height);
                }
            });

            // Draw spawn rate indicator (intensity meter)
            const spawnRate = getSpawnRate();
            const intensity = (spawnRate - 0.015) / (0.08 - 0.015);
            
            ctx.fillStyle = `rgba(239, 68, 68, ${0.3 + intensity * 0.7})`;
            ctx.fillRect(canvas.width - 120, 10, 100 * intensity, 10);
            ctx.strokeStyle = '#ef4444';
            ctx.lineWidth = 1;
            ctx.strokeRect(canvas.width - 120, 10, 100, 10);
            
            ctx.fillStyle = '#ffffff';
            ctx.font = '10px Arial';
            ctx.textAlign = 'right';
            ctx.fillText('Intensitas', canvas.width - 25, 30);

            // Draw pause overlay
            if (gameState === 'paused') {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#10b981';
                ctx.font = 'bold 32px Orbitron';
                ctx.textAlign = 'center';
                ctx.fillText('PAUSED', canvas.width / 2, canvas.height / 2);
            }
        }

        function createParticles(x, y) {
            const rect = canvas.getBoundingClientRect();
            const canvasScale = rect.width / canvas.width;
            const screenX = rect.left + x * canvasScale;
            const screenY = rect.top + y * canvasScale;
            
            for (let i = 0; i < 25; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = screenX + 'px';
                particle.style.top = screenY + 'px';
                document.body.appendChild(particle);

                const angle = (Math.PI * 2 * i) / 25;
                const distance = 60 + Math.random() * 120;
                const targetX = Math.cos(angle) * distance;
                const targetY = Math.sin(angle) * distance;

                anime({
                    targets: particle,
                    translateX: targetX,
                    translateY: targetY,
                    opacity: [1, 0],
                    scale: [1.8, 0],
                    rotate: '3turn',
                    duration: 1000 + Math.random() * 500,
                    easing: 'easeOutExpo',
                    complete: () => {
                        particle.remove();
                    }
                });
            }
            
            // Screen flash effect
            const flash = document.createElement('div');
            flash.style.position = 'fixed';
            flash.style.top = '0';
            flash.style.left = '0';
            flash.style.width = '100vw';
            flash.style.height = '100vh';
            flash.style.background = 'radial-gradient(circle, rgba(16, 185, 129, 0.3) 0%, transparent 70%)';
            flash.style.pointerEvents = 'none';
            flash.style.zIndex = '999';
            document.body.appendChild(flash);
            
            anime({
                targets: flash,
                opacity: [0.8, 0],
                duration: 400,
                easing: 'easeOutQuad',
                complete: () => flash.remove()
            });
        }

        function winGame() {
            gameState = 'won';
            document.getElementById('bgm').pause();
            document.getElementById('winSfx').play().catch(e => {});
            
            showGameOverMenu('win', score);
        }

        function loseGame() {
            gameState = 'lost';
            document.getElementById('bgm').pause();
            document.getElementById('loseSfx').play().catch(e => {});
            
            showGameOverMenu('lose', score);
        }

        function showGameOverMenu(result, finalScore) {
            setTimeout(() => {
                if (result === 'win') {
                    document.getElementById('gameOverIcon').textContent = 'üéâ';
                    document.getElementById('gameOverTitle').textContent = 'SELAMAT!';
                    document.getElementById('gameOverMessage').textContent = 'Kamu berhasil mengumpulkan 100 botol!';
                } else {
                    document.getElementById('gameOverIcon').textContent = 'üíî';
                    document.getElementById('gameOverTitle').textContent = 'GAME OVER!';
                    document.getElementById('gameOverMessage').textContent = 'Kamu menangkap sampah yang salah!';
                }
                
                document.getElementById('finalScore').querySelector('span').textContent = finalScore;
                
                // Animate game over screen
                const gameOverScreen = document.getElementById('gameOverScreen');
                gameOverScreen.classList.remove('hidden');
                
                anime({
                    targets: gameOverScreen.querySelector('div'),
                    scale: [0.5, 1],
                    opacity: [0, 1],
                    duration: 500,
                    easing: 'easeOutBack'
                });
                
            }, 500);
        }

        function restartGame() {
            // Hide screens
            document.getElementById('gameOverScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('menuScreen').classList.remove('hidden');
            
            // Clean up
            if (basketShadow) basketShadow.remove();
            removePointerControls();
            
            // Reset state
            gameState = 'menu';
        }

        function exitGame() {
            window.close();
        }

        function gameLoop() {
            update();
            render();
            
            if (gameState === 'playing' || gameState === 'paused') {
                requestAnimationFrame(gameLoop);
            }
        }

        // Initialize when page loads
        window.addEventListener('load', init);
    </script>

</body>
</html>